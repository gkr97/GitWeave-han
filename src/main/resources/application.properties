spring.application.name=gitserver
spring.profiles.active=dev

# [Flyway]
spring.flyway.enabled=true
spring.flyway.locations=classpath:db/migration

# [Redis]
spring.data.redis.host=localhost
spring.data.redis.port=6379

# [DynamoDB - \uB85C\uCEEC \uAC1C\uBC1C\uC6A9]
dynamodb.endpoint=${DYNAMODB_ENDPOINT}
dynamodb.region=${DYNAMODB_REGION}
dynamodb.access-key=${DYNAMODB_ACCESS_KEY}
dynamodb.secret-key=${DYNAMODB_SECRET_KEY}
aws.dynamodb.gitIndexTable=${AWS_DYNAMODB_GIT_INDEX_TABLE}

# [AWS(LocalStack) - S3, SQS, SNS]
cloud.aws.region.static=${CLOUD_AWS_REGION_STATIC}
cloud.aws.credentials.access-key=${AWS_ACCESS_KEY_ID}
cloud.aws.credentials.secret-key=${AWS_SECRET_ACCESS_KEY}
cloud.aws.s3.endpoint=${CLOUD_AWS_S3_ENDPOINT}
cloud.aws.sqs.endpoint=${CLOUD_AWS_SQS_ENDPOINT}
cloud.aws.s3.bucket=${CLOUD_AWS_S3_BUCKET}
cloud.aws.s3.public-endpoint=${CLOUD_AWS_S3_PUBLIC_ENDPOINT:}
cloud.aws.sqs.indexing-failure-queue-url=${CLOUD_AWS_SQS_INDEXING_FAILURE_QUEUE_URL:}

# [\uD504\uB860\uD2B8\uC5D4\uB4DC]
app.frontend.base-url=${FRONTEND_BASE_URL:http://localhost:3000}


# [\uAE30\uD0C0 \uACF5\uD1B5]
server.port=8080
spring.jackson.time-zone=Asia/Seoul
spring.jackson.locale=ko_KR
spring.servlet.multipart.max-file-size=50MB
spring.servlet.multipart.max-request-size=100MB

# [Actuator]
management.endpoints.web.exposure.include=health,info,metrics,prometheus,circuitbreakers,circuitbreakerevents
management.endpoint.health.show-details=when-authorized
management.metrics.export.prometheus.enabled=true
management.metrics.tags.application=${spring.application.name}

# [Resilience4j]
resilience4j.circuitbreaker.instances.s3.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.s3.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.s3.sliding-window-size=10
resilience4j.circuitbreaker.instances.s3.minimum-number-of-calls=5

resilience4j.circuitbreaker.instances.dynamodb.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.dynamodb.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.dynamodb.sliding-window-size=10
resilience4j.circuitbreaker.instances.dynamodb.minimum-number-of-calls=5

resilience4j.circuitbreaker.instances.opensearch.failure-rate-threshold=50
resilience4j.circuitbreaker.instances.opensearch.wait-duration-in-open-state=30s
resilience4j.circuitbreaker.instances.opensearch.sliding-window-size=10
resilience4j.circuitbreaker.instances.opensearch.minimum-number-of-calls=5

resilience4j.retry.instances.s3.max-attempts=3
resilience4j.retry.instances.s3.wait-duration=200ms
resilience4j.retry.instances.s3.multiplier=2

resilience4j.retry.instances.dynamodb.max-attempts=3
resilience4j.retry.instances.dynamodb.wait-duration=200ms
resilience4j.retry.instances.dynamodb.multiplier=2

resilience4j.retry.instances.opensearch.max-attempts=3
resilience4j.retry.instances.opensearch.wait-duration=200ms
resilience4j.retry.instances.opensearch.multiplier=2

# [GraphQL]
spring.graphql.path=/graphql
spring.graphql.graphiql.enabled=true
spring.graphql.graphiql.path=/graphiql

spring.messages.basename=messages
spring.messages.encoding=UTF-8

# [Mail(Gmail)]
spring.mail.host=smtp.gmail.com
spring.mail.port=587
spring.mail.username=${MAIL_USERNAME}
spring.mail.password=${MAIL_PASSWORD}
spring.mail.properties.mail.smtp.auth=true
spring.mail.properties.mail.smtp.starttls.enable=true

# [JWT]
jwt.secret=${JWT_SECRET}
jwt.expirationMillis=${JWT_EXPIRATION_MILLIS}

# [SQS - \uC778\uC99D \uBA54\uC77C \uBC1C\uC1A1\uC6A9]
mail.sqs.queue-url=${MAIL_SQS_QUEUE_URL}
cloud.aws.sqs.queue-url=${CLOUD_AWS_SQS_QUEUE_URL}

# [\uC800\uC7A5\uC18C \uACBD\uB85C]
git.storage.bare-path=${GIT_STORAGE_BARE_PATH}
git.storage.workdir-path=${GIT_STORAGE_WORK_PATH}
git.http-backend-path=${GIT_HTTP_BACKEND_PATH}
git.project-root-path=${GIT_PROJECT_ROOT_PATH}
git.server.base-url=${GIT_SERVER_BASE_URL}

logging.level.org.springframework.cache=DEBUG
logging.level.org.springframework.data.redis.cache=DEBUG

spring.devtools.restart.trigger-file=.reloadtrigger

# [Git Routing]
git.routing.enabled=true
git.routing.local-node-id=local
git.routing.local-host=localhost:8080
git.routing.local-zone=
git.routing.local-region=
git.routing.scheme=http
git.routing.read-max-lag-ms=2000
git.routing.cache-ttl-ms=3000
git.routing.use-commit-lag=false
git.routing.read-max-lag-commits=0
git.routing.allowlist-repo-ids=
git.routing.seed-local=true
git.routing.seed-replica-node-ids=local-replica-1
git.routing.seed-replica-add-existing=true
git.routing.seed-replica-heartbeat-enabled=true
git.routing.seed-replica-heartbeat-interval-ms=5000
git.routing.heartbeat-interval-ms=5000
git.routing.node-health-interval-ms=5000
git.routing.node-health-timeout-ms=15000
git.routing.api-key=${GIT_ROUTING_API_KEY:}
git.routing.admin-key=${GIT_ROUTING_ADMIN_KEY:}
git.routing.failover-enabled=false
git.routing.failover-max-lag-ms=5000
git.routing.failover-max-lag-commits=0
git.routing.failover-update-enabled=false
git.routing.failover-alert-webhook=
git.routing.lag-report.enabled=true
git.routing.lag-report-interval-ms=10000
git.routing.lag-report.fetch-primary-enabled=false
git.routing.lag-report.remote-url-template=
git.routing.lag-report.use-owner-name=true
git.routing.placement.enabled=true
git.routing.placement.repo-count-weight=1.0
git.routing.placement.disk-weight=1.0
git.routing.placement.iops-weight=0.1
git.routing.default-replica-node-ids=local-replica-1
git.routing.placement.replica-count=1
git.routing.placement.prefer-same-region=true
git.routing.placement.prefer-same-zone=false
git.routing.autoscale.enabled=true
git.routing.autoscale.interval-ms=60000
git.routing.autoscale.min-replicas=1
git.routing.autoscale.max-replicas=3
git.routing.autoscale.scale-down-enabled=false
git.routing.autoscale.traffic-thresholds=20,100,300
git.routing.autoscale.stars-thresholds=50,200,1000
git.routing.autoscale.watchers-thresholds=50,200,1000
git.routing.autoscale.prefer-same-region=true
git.routing.autoscale.prefer-same-zone=false

git.routing.backfill.enabled=false
git.routing.backfill.run-once=true
git.routing.backfill.interval-ms=60000

# [Git Replication]
git.replication.enabled=true
git.replication.poll-interval-ms=3000
git.replication.max-attempts=3
git.replication.remote-url-template=http://{host}/{owner}/{repo}.git
git.replication.target-bare-path=/tmp/git-replicas
git.replication.use-owner-name=true
git.replication.rebuild-on-failure=false
git.replication.dlq-enabled=true
git.replication.alert-webhook=
git.replication.dlq-reprocess-enabled=false
git.replication.dlq-reprocess-interval-ms=30000
git.replication.dlq-reprocess-max=50
git.replication.worker-parallelism=4
git.replication.priority.traffic-window-ms=60000
git.metrics.enabled=true

# [Rebalance]
git.rebalance.enabled=false
git.rebalance.interval-ms=60000
git.rebalance.disk-threshold=80
git.rebalance.repo-threshold=1000
git.rebalance.iops-threshold=2000
git.rebalance.batch-size=20
git.rebalance.promote-primary=false
git.rebalance.promote-max-lag-commits=0
